% !TEX root = ../altosaar-cv.tex

% from victor veitch
\usepackage{csquotes}
\usepackage[%
minnames=1,maxnames=99,maxcitenames=2,
style=apa, %alphabetic, numeric, apa, authoryear (authoryear includes notes)
% citestyle=apa,
doi=false,
url=false,
giveninits=true,
hyperref,
natbib,
backend=biber, % bibtex, biber
sorting=ydnt,
bibstyle=publist,
plauthorhandling=highlight,
marginyear=true,
boldyear=false,
plnumbered=false,
linktitleurl=false,
]{biblatex}%

% REMOVE "In:" text before venue.
\renewbibmacro{in:}{}

% define command to remove the period after every note
\newcommand\EatDot[1]{}
% \AtEveryBibitem{%
% \iffieldundef{note}
%     {}
%     {\printtext[note]{%
%        \printfield[noformat]{journaltitle}%
%        \EatDot}}
% }  


% biblatex-publist options: http://mirrors.ibiblio.org/CTAN/macros/latex/contrib/biblatex-contrib/biblatex-publist/biblatex-publist.pdf
\plauthorname[Jaan][]{Altosaar}

\renewcommand*\plmarginyear[1]{%
\raggedleft\small\years{#1}%
}

% edit years in margin
% \providecommand*\plmarginyear[1]{%
% \raggedleft\years{#1}%
% }

% make lower case
% \DeclareFieldFormat[article,inbook,incollection,inproceedings,patent,thesis,unpublished]{titlecase}{\MakeSentenceCase*{#1}}
% \AtEvery Bibitem{\printfield{note}}

% print annotation field that was manually added to zotero, in the "Extra" section
% using https://retorque.re/zotero-better-bibtex/exporting/#add-your-own-biblatex-fields
\renewbibmacro{finentry}{%
  \setunit{%
    \finentrypunct
    \renewcommand*{\finentry}{}%
    %\par
    }%
  \printfield{annotation}\EatDot%
  \finentry
}

% https://tex.stackexchange.com/questions/334312/biblatex-declaresourcemap-how-do-we-conditionally-prefix-a-space-when-appending
% \DeclareSourcemap{
%   \maps[datatype=bibtex]{
%     \map[overwrite]{
%       \step[fieldsource=note]
%       \step[fieldset=note, fieldvalue={\EatDot}, append]
%     }
%   }
% }


\AtEveryBibitem{%
\ifentrytype{article}{
    \clearfield{url}%
    \clearfield{urldate}%
    \clearfield{eprint}
}{}
\ifentrytype{book}{
    \clearfield{url}%
    \clearfield{urldate}%
}{}
\ifentrytype{collection}{
    \clearfield{url}%
    \clearfield{urldate}%
}{}
\ifentrytype{incollection}{
    \clearfield{url}%
    \clearfield{urldate}%
}{}
}

\AtEveryBibitem{
    \clearfield{pages}
    \clearfield{review}%
    \clearfield{series}%%
    \clearfield{volume}
    \clearfield{pages}
    \clearfield{month}
    \clearfield{eprint}
    \clearfield{isbn}
    \clearfield{issn}
    \clearlist{location}
    \clearfield{series}
    \clearlist{publisher}
    \clearname{editor}
}{}